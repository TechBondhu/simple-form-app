<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Submission System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'https://cdn.jsdelivr.net/npm/react@18.2.0/+esm';
        import ReactDOM from 'https://cdn.jsdelivr.net/npm/react-dom@18.2.0/+esm';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCoIdMx9Zd7kQt9MSZmowbphaQVRl8D16E",
            authDomain: "admissionformdb.firebaseapp.com",
            projectId: "admissionformdb",
            storageBucket: "admissionformdb.firebasestorage.app",
            messagingSenderId: "398052082157",
            appId: "1:398052082157:web:0bc02d66cbdf55dd2567e4
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // React Components
        const App = () => {
            const [user, setUser] = useState(null);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [name, setName] = useState('');
            const [details, setDetails] = useState('');
            const [isSignup, setIsSignup] = useState(true);
            const [error, setError] = useState('');

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                });
                return () => unsubscribe();
            }, []);

            const handleAuth = async () => {
                try {
                    setError('');
                    if (isSignup) {
                        await auth.createUserWithEmailAndPassword(email, password);
                        alert('Sign Up Successful! Please Log In.');
                        setIsSignup(false);
                    } else {
                        await auth.signInWithEmailAndPassword(email, password);
                    }
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleLogout = async () => {
                await auth.signOut();
                setEmail('');
                setPassword('');
                setIsSignup(true);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    await db.collection('applications').add({
                        name,
                        details,
                        userId: user.uid,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('Application Submitted Successfully!');
                    setName('');
                    setDetails('');
                } catch (err) {
                    setError('Failed to submit application: ' + err.message);
                }
            };

            if (user) {
                return (
                    <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4">
                        <div className="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
                            <h2 className="text-2xl font-bold mb-6 text-center">Submit Application</h2>
                            <button
                                onClick={handleLogout}
                                className="w-full bg-red-600 text-white py-2 rounded-md hover:bg-red-700 mb-4"
                            >
                                Log Out
                            </button>
                            <form onSubmit={handleSubmit}>
                                <div className="mb-4">
                                    <label className="block text-gray-700 mb-2" htmlFor="name">Full Name</label>
                                    <input
                                        type="text"
                                        id="name"
                                        value={name}
                                        onChange={(e) => setName(e.target.value)}
                                        className="w-full p-2 border rounded-md"
                                        required
                                    />
                                </div>
                                <div className="mb-4">
                                    <label className="block text-gray-700 mb-2" htmlFor="details">Application Details</label>
                                    <textarea
                                        id="details"
                                        value={details}
                                        onChange={(e) => setDetails(e.target.value)}
                                        className="w-full p-2 border rounded-md"
                                        rows="5"
                                        required
                                    ></textarea>
                                </div>
                                {error && <p className="text-red-500 mb-4">{error}</p>}
                                <button
                                    type="submit"
                                    className="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700"
                                >
                                    Submit Application
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4">
                    <div className="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
                        <h2 className="text-2xl font-bold mb-6 text-center">{isSignup ? 'Sign Up' : 'Log In'}</h2>
                        <div className="mb-4">
                            <label className="block text-gray-700 mb-2" htmlFor="email">Email</label>
                            <input
                                type="email"
                                id="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                className="w-full p-2 border rounded-md"
                                required
                            />
                        </div>
                        <div className="mb-4">
                            <label className="block text-gray-700 mb-2" htmlFor="password">Password</label>
                            <input
                                type="password"
                                id="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                className="w-full p-2 border rounded-md"
                                required
                            />
                        </div>
                        {error && <p className="text-red-500 mb-4">{error}</p>}
                        <button
                            onClick={handleAuth}
                            className="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700"
                        >
                            {isSignup ? 'Sign Up' : 'Log In'}
                        </button>
                        <p className="mt-4 text-center">
                            {isSignup ? 'Already have an account?' : 'Need an account?'}
                            <button
                                onClick={() => setIsSignup(!isSignup)}
                                className="text-blue-600 hover:underline ml-1"
                            >
                                {isSignup ? 'Log In' : 'Sign Up'}
                            </button>
                        </p>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>